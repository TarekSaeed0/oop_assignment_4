<div class="h-full bg-white">
  
  @if (selectedMail()) {
    <app-mail-in-trash 
        [mail]="selectedMail()!" 
        (back)="closeMail()">
    </app-mail-in-trash>
  } 
  
  @else {
    <div class="flex flex-col h-full">
      
      <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-white sticky top-0 z-10">
        <div class="flex items-center gap-4">
            
            <input 
                type="checkbox" 
                class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"
                [checked]="isAllSelected()"
                (change)="toggleSelectAll()"
                title="Select All"
            >
            <button 
        (click)="handleRefresh()" 
        class="p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500 hover:text-blue-600"
        title="Refresh List">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
        </svg>
    </button>

            @if (selectedIds().length > 0) {
                <div class="flex items-center gap-2 pl-4 border-l border-gray-300 animate-fade-in">
                    
                    <button 
                        (click)="handleBulkRestore()" 
                        class="p-2 hover:bg-green-50 text-green-600 rounded-full transition-colors"
                        title="Restore Selected">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                        </svg>
                    </button>

                    <button 
                        (click)="handleBulkDelete()" 
                        class="p-2 hover:bg-red-50 text-red-600 rounded-full transition-colors"
                        title="Delete Forever Selected">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397" />
                        </svg>
                    </button>
                    
                    <span class="text-sm text-gray-500 ml-2 font-medium">{{ selectedIds().length }} selected</span>
                </div>
            } @else {
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-red-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>
                    Trash
                </h2>
            }
        </div>
        <span class="text-xs text-gray-400 font-medium bg-gray-100 px-3 py-1 rounded-full">Auto-delete after 30 days</span>
      </div>

      <div class="overflow-y-auto grow">
        @if (mails().length === 0) {
          <div class="flex flex-col items-center justify-center h-full text-gray-400">
            <span class="text-6xl mb-4 opacity-50">üóëÔ∏è</span>
            <p class="font-medium">Trash is empty</p>
          </div>
        } @else {
          <div class="flex flex-col divide-y divide-gray-50">
            @for (mail of mails(); track mail.id) {
              
              <div 
                (click)="openMail(mail)" 
                class="group flex items-center px-6 py-4 hover:bg-gray-50 cursor-pointer transition-colors duration-150 relative"
                [class.bg-blue-50]="selectedIds().includes(mail.id)"
              >
                
                <div class="mr-4" (click)="$event.stopPropagation()">
                    <input 
                        type="checkbox" 
                        class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"
                        [checked]="selectedIds().includes(mail.id)"
                        (change)="toggleId(mail.id)"
                    >
                </div>

                <div class="mr-4 text-gray-400" [title]="mail.source === 'SENT' ? 'Originally Sent' : 'Originally Received'">
                  @if (mail.source === 'SENT') {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.25-7.25a.75.75 0 0 0 0-1.5H8.66l2.1-1.95a.75.75 0 1 0-1.02-1.1l-3.5 3.25a.75.75 0 0 0 0 1.1l3.5 3.25a.75.75 0 0 0 1.02-1.1l-2.1-1.95h4.59Z" clip-rule="evenodd" />
                    </svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-11.25a.75.75 0 0 0-1.5 0v4.59L7.3 9.24a.75.75 0 0 0-1.1 1.02l3.25 3.5a.75.75 0 0 0 1.1 0l3.25-3.5a.75.75 0 1 0-1.1-1.02l-1.95 2.1V6.75Z" clip-rule="evenodd" />
                    </svg>
                  }
                </div>

                <div class="w-1/4 min-w-[150px] font-semibold text-gray-800 truncate pr-4">
                  {{ getParticipantDisplay(mail) }}
                </div>

                <div class="grow flex items-center min-w-0">
                  <span class="font-medium text-gray-800 truncate">{{ mail.subject }}</span>
                  <span class="mx-2 text-gray-300">-</span>
                  <span class="text-gray-500 truncate text-sm flex-1">{{ mail.body }}</span>
                </div>

                <div class="w-24 text-right text-xs text-gray-500 pl-2 whitespace-nowrap">
                  {{ mail.date | date:'MMM d' }}
                </div>

                <div class="absolute right-4 hidden group-hover:flex items-center bg-white/80 backdrop-blur-sm pl-2 rounded-l-lg">
                    <button 
                        (click)="handleSingleDelete(mail.id); $event.stopPropagation()"
                        class="p-2 hover:bg-red-100 text-gray-400 hover:text-red-600 rounded-full transition-colors"
                        title="Delete Forever">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397" />
                        </svg>
                    </button>
                </div>

              </div>
            }
          </div>
        }
      </div>
    </div>
  }
</div>